<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Q&A | Jio.film</title>
    <link rel="stylesheet" href="style.css" />
    <style>

    </style>
</head>

<body>
    <div class="wrapper">
        <!-- Header ì¬ì‚¬ìš© -->
        <header class="header">
            <button id="menuToggle" class="menu-button">â˜°</button>
            <h1 class="logo"><a href="index.html">Jio.film</a></h1>
            <nav class="nav"></nav>
        </header>

        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar hidden">
            <button id="closeSidebar" class="close-btn">âœ•</button>
            <ul>
                <li><a href="about.html">About</a></li>
                <li><a href="album.html">Album</a></li>
                <li><a href="shopping.html">Shopping</a></li>
                <li><a href="qna.html">Q&A</a></li>
                <li><a href="photo_review.html">Photo Review</a></li>
                <li><a href="notice.html">Notice</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="map.html">ì˜¤ì‹œëŠ” ê¸¸</a></li>
            </ul>
        </aside>
        <div id="overlay" class="overlay hidden"></div>

        <!-- Main -->
        <main class="qna-main">
            <section id="qna-list-view" style="display: block;">
                <div class="qna-header">
                    <h1>Q&A</h1>
                    <button class="qna-write-btn">ê¸€ì“°ê¸°</button>
                </div>
                <table class="qna-table">
                    <thead>
                        <tr>
                            <th>ê²Œì‹œê¸€ ì œëª©</th>
                            <th>ì‘ì„±ì</th>
                            <th>ì‘ì„± ì¼ì</th>
                            <th>ë‹µë³€ ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                    </table>
            </section>

            <!-- ì§ˆë¬¸ê¸€ ì‘ì„± -->
            <section id="qna-write-view" class="qna-container" style="display: none;">
                <div class="qna-write-header">
                    <input type="text" id="qna-title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />
                    <div class="visibility-toggle">
                    <button id="btn-public" class="active">ê³µê°œ</button>
                    <button id="btn-private">ë¹„ê³µê°œ</button>
                    </div>
                </div>
                <textarea id="qna-content" placeholder="ì§ˆë¬¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                <div class="qna-write-footer">
                    <button id="btn-submit">ì™„ë£Œ</button>
                    <button id="btn-delete">ì‚­ì œ</button>
                </div>
            </section>

            <!-- ì§ˆë¬¸ê¸€ ë³´ê¸° -->
            <section id="qna-read-view" class="qna-container" style="display: none;">
                <div id="qna-read-title" class="qna-read-title"></div>
                <div id="qna-read-content" class="qna-read-content"></div>
                <div id="qna-private-message" class="qna-private-warning" style="display: none;">ë¹„ê³µê°œ ê¸€ì…ë‹ˆë‹¤.</div>
            </section>
        </main>

        <footer class="footer">
            <div class="footer-info">
                (ì£¼)ì§€ì˜¤í•„ë¦„ ëŒ€í‘œ ì •ì§€ì€<br>
                ì„œìš¸íŠ¹ë³„ì‹œ ìš©ì‚°êµ¬ ì²­íŒŒë¡œ47ê¸¸ 100<br>
                ì§€ì˜¤í•„ë¦„ ì½˜í…ì¸ ì˜ ì €ì‘ê¶Œì€ ì €ì‘ê¶Œìì—ê²Œ ìˆìœ¼ë©°, ì´ë¥¼ ë¬´ë‹¨ ì‚¬ìš© ë° ë„ìš©í•˜ëŠ” ê²½ìš° ì €ì‘ê¶Œë²• ë“±ì— ë”°ë¼ ë²•ì  ì±…ì„ì„ ì§ˆ ìˆ˜ ìˆìŒì„ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤.<br>
                Â©2025 Jio.film Corp. All rights reserved.<br>
            </div>
        </footer>
    </div>
    </div>

<script>
// ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
const loginUser = JSON.parse(sessionStorage.getItem("loginUser") || "null");
const sessionUser = loginUser?.name || null;
const isAdmin = loginUser?.role === "admin";

// Q&A ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë˜ëŠ” ì´ˆê¸°í™”
let qnaData = JSON.parse(localStorage.getItem("qnaData") || "[]");


function showView(viewId) {
    document.querySelectorAll("main > section").forEach(sec => sec.style.display = "none");
    document.getElementById(viewId).style.display = "block";
}

// ê¸€ì“°ê¸° ë²„íŠ¼
const writeBtn = document.querySelector(".qna-write-btn");
document.querySelector(".qna-write-btn").addEventListener("click", () => {
    // ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬
    if (!sessionUser) {
        // ë¡œê·¸ì¸ ì•ˆ ëœ ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        window.location.href = "login.html";
        return;
    }
    document.getElementById("qna-title").value = "";
    document.getElementById("qna-content").value = "";
    document.getElementById("btn-public").classList.add("active");
    document.getElementById("btn-private").classList.remove("active");
    showView("qna-write-view");
});

// ê³µê°œ/ë¹„ê³µê°œ í† ê¸€
let isPrivate = false;
function toggleVisibilityButtons() {
    document.getElementById("btn-public").classList.toggle("active", !isPrivate);
    document.getElementById("btn-private").classList.toggle("active", isPrivate);
}
document.getElementById("btn-public").onclick = () => { isPrivate = false; toggleVisibilityButtons(); };
document.getElementById("btn-private").onclick = () => { isPrivate = true; toggleVisibilityButtons(); };

// ê²Œì‹œê¸€ ë“±ë¡
const submitBtn = document.getElementById("btn-submit");
submitBtn?.addEventListener("click", () => {
    const title = document.getElementById("qna-title").value.trim();
    const content = document.getElementById("qna-content").value.trim();
    if (!title || !content) return alert("ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    qnaData.unshift({
        id: Date.now(),
        title, content,
        writer: sessionUser,
        isPrivate,
        date: new Date().toISOString().split("T")[0],
        answer: null
    });
    localStorage.setItem("qnaData", JSON.stringify(qnaData));
    renderList();
    showView("qna-list-view");
});

// ëª©ë¡ ë Œë”ë§
function renderList() {
    const tbody = document.querySelector("#qna-list-view tbody");
    tbody.innerHTML = "";
    qnaData.forEach(post => {
        const tr = document.createElement("tr");

        // ì œëª© ì…€
        const tdTitle = document.createElement("td");
        const a = document.createElement("a");
        a.href = "#";
        a.textContent = post.isPrivate ? `ğŸ”’ ${post.title}` : post.title;
        a.addEventListener("click", e => {
            e.preventDefault();
            if (!sessionUser) {
                location.href = "login.html";
                return;
            }

            if (isAdmin) {
                openAdminReply(post);
            } else if (post.writer === sessionUser) {
                openModifyPost(post); // ì‚¬ìš©ì ë³¸ì¸ ê¸€ ìˆ˜ì •
            } else if (post.isPrivate) {
                alert("ë¹„ê³µê°œ ê¸€ì…ë‹ˆë‹¤."); // ì‘ì„±ìë„ ê´€ë¦¬ìë„ ì•„ë‹ˆë©´ ì°¨ë‹¨
            } else {
                openPost(post); // ê³µê°œê¸€ ì½ê¸°
            }
        });
        tdTitle.appendChild(a);
        tr.appendChild(tdTitle);

        // ì‘ì„±ì
        const tdWriter = document.createElement("td");
        tdWriter.textContent = post.writer;
        tr.appendChild(tdWriter);

        // ë‚ ì§œ
        const tdDate = document.createElement("td");
        tdDate.textContent = post.date;
        tr.appendChild(tdDate);

        // ìƒíƒœ
        const tdStatus = document.createElement("td");
        tdStatus.className = "status " + (post.answer ? "answered" : "waiting");
        tdStatus.textContent = post.answer ? "ë‹µë³€ ì™„ë£Œ" : "ë¯¸ë‹µë³€";
        tr.appendChild(tdStatus);

        tbody.appendChild(tr);

        // ë‹µë³€ ë¯¸ë¦¬ë³´ê¸° í–‰
        if (post.answer) {
            const reply = document.createElement("tr");
            const replyTd = document.createElement("td");
            replyTd.colSpan = 4;
            replyTd.style.color = "gray";
            replyTd.style.paddingLeft = "30px";
            replyTd.textContent = `â†³ Re: ${post.answer.length > 50 ? post.answer.slice(0, 50) + "â€¦" : post.answer}`;
            reply.appendChild(replyTd);
            tbody.appendChild(reply);
        }
    });
}

// ì‚¬ìš©ì ê²Œì‹œê¸€ ìˆ˜ì •
function openModifyPost(post) {
    // ê¸°ì¡´ ê¸€ì“°ê¸° ë·°ë¥¼ ìˆ˜ì • ëª¨ë“œë¡œ ì‚¬ìš©
    document.getElementById("qna-title").value = post.title;
    document.getElementById("qna-content").value = post.content;
    isPrivate = post.isPrivate;
    toggleVisibilityButtons();

    showView("qna-write-view");

    // ê¸°ì¡´ ì™„ë£Œ ë²„íŠ¼ì— ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆ ì œê±° í›„ ìƒˆ ë¦¬ìŠ¤ë„ˆ ë°”ì¸ë”©
    const submitBtn = document.getElementById("btn-submit");
    const newBtn = submitBtn.cloneNode(true); // ë²„íŠ¼ ìƒˆë¡œ ë³µì œ
    submitBtn.parentNode.replaceChild(newBtn, submitBtn); // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±°

    newBtn.addEventListener("click", () => {
        const title = document.getElementById("qna-title").value.trim();
        const content = document.getElementById("qna-content").value.trim();
        if (!title || !content) return alert("ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        post.title = title;
        post.content = content;
        post.isPrivate = isPrivate;
        localStorage.setItem("qnaData", JSON.stringify(qnaData));
        renderList();
        showView("qna-list-view");
    });

    // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ë°”ì¸ë”©
    const deleteBtn = document.getElementById("btn-delete");
    const newDeleteBtn = deleteBtn.cloneNode(true);
    deleteBtn.parentNode.replaceChild(newDeleteBtn, deleteBtn);

    newDeleteBtn.addEventListener("click", () => {
        if (!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        qnaData = qnaData.filter(item => item.id !== post.id);
        localStorage.setItem("qnaData", JSON.stringify(qnaData));
        renderList();
        showView("qna-list-view");
    });
}

// ê²Œì‹œê¸€ ì½ê¸°
function openPost(post) {
    document.getElementById("qna-private-message").style.display = "none";
    document.getElementById("qna-read-title").textContent = `ì œëª©: ${post.title}`;
    document.getElementById("qna-read-content").innerHTML = `
        <p><strong>ì‘ì„±ì:</strong> ${post.writer}</p>
        <p><strong>ë‚´ìš©:</strong><br>${post.content.replace(/\n/g, "<br>")}</p>
    `;
    showView("qna-read-view");
}

// ê´€ë¦¬ì ë‹µë³€ ì…ë ¥ ë·°
function openAdminReply(post) {
    let adminSection = document.getElementById("qna-admin-reply-view");
    if (!adminSection) {
        adminSection = document.createElement("section");
        adminSection.id = "qna-admin-reply-view";
        adminSection.innerHTML = `
            <h2 id="admin-reply-title"></h2>
            <p id="admin-reply-content"></p>
            <textarea id="admin-reply-text" placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            <button id="btn-admin-reply-submit">ë‹µë³€ ë“±ë¡</button>
        `;
        document.querySelector("main").appendChild(adminSection);
    }
    document.getElementById("admin-reply-title").textContent = post.title;
    document.getElementById("admin-reply-content").textContent = post.content;
    document.getElementById("admin-reply-text").value = post.answer || "";
    document.getElementById("btn-admin-reply-submit").onclick = () => {
        const answer = document.getElementById("admin-reply-text").value.trim();
        if (!answer) return alert("ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”.");
        post.answer = answer;
        localStorage.setItem("qnaData", JSON.stringify(qnaData)); // ì´ ì¤„ ì¶”ê°€
        renderList();
        showView("qna-list-view");
    };
    showView("qna-admin-reply-view");
}
renderList();
showView("qna-list-view");
</script>
<script type="text/javascript" src="common.js"></script>
</body>
</html>